<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon Lane Runner</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/game.css" />
  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/authenticator.js"></script>
  <script type="module" src="js/game.js"></script>
</head>
<body>

<!-- ⏳ Loader -->
<div id="loader" style="display:none;">
  <div class="spinner"></div>
  <p>Chargement...</p>
</div>

<!-- 🔐 Connexion / Inscription -->
<div id="loginDiv">
  <div class="login-card">
    <div class="logo-block">
      <div class="fb-logo">Neon Lane</div>
      <div class="logo-sub">Runner — by Kabir & Samuel</div>
      <div style="font-size:12px;color:rgba(255,255,255,0.45);margin-top:8px;text-align:center">
        Connexion rapide — pseudo uniquement
      </div>
    </div>
    <div class="login-form">
      <div style="display:flex; gap:10px; align-items:center;">
        <input id="loginName" type="text" placeholder="Pseudo" style="flex:1;">
        <input id="loginPassword" type="password" placeholder="Mot de passe" style="width:220px;">
      </div>
      <div class="form-row">
        <button class="btn primary" id="loginBtn">Connexion</button>
        <button class="btn secondary" id="signupBtn">Créer un compte</button>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <label style="font-size:13px;color:rgba(255,255,255,0.6);">Langue</label>
        <select id="langSelect" style="padding:6px;border-radius:6px;background:rgba(255,255,255,0.02);color:var(--text);border:1px solid rgba(255,255,255,0.03)">
          <option value="fr">français</option>
          <option value="en">english</option>
        </select>
        <label style="margin-left:auto; font-size:13px; color:rgba(255,255,255,0.6);">Son</label>
        <input type="checkbox" id="soundToggle" checked>
      </div>
      <div id="loginMsg"></div>
      <footer>© 2025 Kabir &amp; Samuel Deporno — All rights reserved</footer>
    </div>
  </div>
</div>

<!-- 🎮 Jeu -->
<div id="gameDiv" style="display:none;">
  <canvas id="gameCanvas"></canvas>
  <!-- HUD, paramètres, pause, victoire, etc. sont gérés dans game.js -->
</div>

<script type="module">
  import { loginUser, signupUser } from './js/authenticator.js';

  const loginMsg = document.getElementById("loginMsg");
  const loader = document.getElementById("loader");

  function showLoader(msg) {
    loader.style.display = "flex";
    loader.querySelector("p").textContent = msg;
  }

  function hideLoader() {
    loader.style.display = "none";
  }

  document.getElementById("loginBtn").addEventListener("click", async () => {
    loginMsg.textContent = "";
    showLoader("Connexion...");
    try {
      const user = await loginUser();
      hideLoader();
      document.getElementById("loginDiv").style.display = "none";
      document.getElementById("gameDiv").style.display = "block";
      startGame(user.displayName || "Joueur");
    } catch (err) {
      hideLoader();
      loginMsg.textContent = err.message;
      loginMsg.style.color = "#ff8a8a";
    }
  });

  document.getElementById("signupBtn").addEventListener("click", async () => {
    loginMsg.textContent = "";
    showLoader("Inscription...");
    try {
      await signupUser();
      hideLoader();
      loginMsg.textContent = "Inscription réussie ! Connecte-toi.";
      loginMsg.style.color = "#9fffb2";
    } catch (err) {
      hideLoader();
      loginMsg.textContent = err.message;
      loginMsg.style.color = "#ff8a8a";
    }
  });
</script>

</body>
</html>
